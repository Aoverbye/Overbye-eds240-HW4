---
title: "HW2-exploration.qmd"
author: "Amanda Overbye"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---
Create an file named, HW2-exploration.qmd within your lastName-eds240-HW4 repo and add appropriate YAML fields.

#2a. Review HW #4 instructions
Please begin by re-reading HW #4 in full as a reminder of the options, goals, and requirements for your final class assignment.

# 2b. Import & wrangle data, then create exploratory data viz
This week, you’ll focus on importing and wrangling your data (found as part of HW #1, Part II), followed by the exploratory data visualization phase. Complete the following:


## Load necessary packages and read in your data.
```{r}
# Load packages
library(tidycensus)
library(tidyverse)
library(ggplot2)
library(tmap)
library(here)
library(janitor)
library(usdata)
library(tigris)
library(sf)
library(scales)
library(airportr)
library(ggmap)
library(maps)
```


```{r}
# Testing maps
map_data_es <- map_data('world')[map_data('world')$region == "USA",]
world <- worldMapEnv
```

```{r}
# Load in the data
freight_df <- read.csv(here("data", "International_Report_Freight_20250205.csv"))

air_coords <- airports
```

Clean & wrangle your data.

# Data seems pretty clean already
Removed column type because the type for the whole file is the same

```{r}
# Clean names
clean_freight <- freight_df %>%
clean_names()
clean_airports <- air_coords %>% 
  clean_names()
```


```{r}
clean_freight <- clean_freight %>% 
  select(-type) %>% 
```

```{r}
clean_airports <- clean_airports %>% 
  select(-timezone, -type, -altitude, -country_code, -country_code_alpha_2, -country_code_alpha_3, -open_flights_id, -source)
```

```{r}
# Rename column for join 
clean_freight <- clean_freight %>% 
  rename(iata = usg_apt)
```


```{r}
# Create 2024 df to be able to test basic geographical ideas without a giant df
freight_2024 <- clean_freight %>% 
  filter(year == 2024) %>% 
  filter(carriergroup == 1)
```


### Join the clean_airports and  freight_2024

```{r}
geo_planes2024 <- full_join(freight_2024, clean_airports)
```

```{r}
 geo_planes2024$country
```


```{r}
geo_planes2024 <- geo_planes2024 %>%
  filter(country == "United States")
```


Create at least three exploratory data visualizations (but of course feel free to create more!). The goal of these visualizations is to explore your data for any potentially interesting patterns or trends, which you or may not decide to pursue further as you iterate on your final project deliverable. These plots do not need to be polished (e.g. updated theme), but it may be helpful to try arranging data to identify any trends.

```{r}
ggplot(clean_freight, aes(x = carriergroup, y = total)) +
  geom_col() +
  scale_x_continuous(labels = scales::comma)

```

```{r}
# Summarize total flights per airport
airport_flights <- geo_planes2024 %>%
  group_by(iata, name, latitude, longitude) %>%
  summarise(total_flights = sum(total, na.rm = TRUE)) %>%
  arrange(desc(total_flights))

# Get the airport with the highest flights
top_airport <- airport_flights %>% slice(1)
print(top_airport)

```

```{r}
# Load US states data
usa_map <- map_data("state")

# Plot contiguous USA
ggplot(data = usa_map, aes(x = long, y = lat, group = group)) +
  geom_polygon(fill = "lightgray", color = "black") +
  theme_minimal() +
  labs(title = "Contiguous USA Basemap") +
  coord_fixed(1.3)  # Fix aspect ratio
```


```{r}
# Load world map data
world_map <- map_data("world")

# Create the basemap
ggplot(data = world_map, aes(x = long, y = lat, group = group)) +
  geom_polygon(fill = "lightgray", color = "black") +
  theme_minimal() +
  labs(title = "World Map Basemap") +
  coord_fixed(1.3)  # Fix aspect ratio

```

```{r}
# Ensure latitude and longitude are numeric
geo_planes2024$latitude <- as.numeric(geo_planes2024$latitude)
geo_planes2024$longitude <- as.numeric(geo_planes2024$longitude)

# Create the basemap with airport locations
ggplot() +
  # Plot the USA basemap
  geom_polygon(data = usa_map, aes(x = long, y = lat, group = group), 
               fill = "lightgray", color = "black") +
  # Add airport locations as points
  geom_point(data = geo_planes2024, 
             aes(x = longitude, y = latitude, color = carrier), 
             size = 3, alpha = 0.7) +
  # Add labels for airport IATA codes
  geom_text(data = geo_planes2024, 
            aes(x = longitude, y = latitude, label = iata), 
            vjust = -1, size = 3) +
  theme(legend.position = "none")
  theme_minimal() +
  labs(title = "Airport Locations in the Contiguous USA",
       x = "Longitude", y = "Latitude", color = "Carrier") +
  coord_fixed(1.3)  # Fix aspect ratio
```

# TEST

```{r}
# Convert carriergroup to a factor for better labeling
freight_df <- freight_df %>%
  mutate(carriergroup = factor(carriergroup, levels = c(0, 1), labels = c("Scheduled", "Charter")))

# Summarize the count of each flight type
flight_counts <- freight_df %>%
  group_by(carriergroup) %>%
  summarise(count = n())

# Create the bar plot
ggplot(flight_counts, aes(x = carriergroup, y = count, fill = carriergroup)) +
  geom_bar(stat = "identity") +
  labs(title = "Count of Charter vs. Scheduled Flights",
       x = "Flight Type",
       y = "Count of Flights") +
  theme_minimal() +
  scale_fill_manual(values = c("Scheduled" = "blue", "Charter" = "red")) +
  scale_x_continuous(labels = scales::comma)
```

IMPORTANT: If you have a downloaded data file saved to your repo (e.g. you’re not reading in your data directly from online, from a server, etc.) be sure to add your data folder / file to your .gitignore, particularly if this file is large.

2c. Answer questions
After completing the above steps, answer the following questions:

1. What have you learned about your data? Have any potentially interesting patterns emerged?
2. In HW #1, you outlined some questions that you wanted to answer using these data. Have you made any strides towards answering those questions? If yes, how so? If no, what next steps do you need to take (e.g. I need to create X plot type, I still need to track down Y data, I need to restructure existing data so that you can visualize it in Z ways, etc.)?
3. What challenges do you foresee encountering with your data? These can be data wrangling and / or visualization challenges.
Rubric (specifications)
You must complete the following, as detailed below, to receive a “Satisfactory” mark for Assignment #2, Part II:

Complete the following steps under your lastName-eds240-HW4 repo, not in GitHub Classroom:
See details below.

Perform all Part 2b steps (as described above) in your HW2-exploration.qmd file.
Answer Part 2c questions in your HW2-exploration.qmd file. There is no set length requirement, but you must answer each question in full to receive a Satisfactory score.
All three plot outputs should appear in your rendered doc.
HW2-exploration.qmd should be neatly organized – this does not need to be a perfectly polished document, but sections should be clearly labeled with prose and / or annotations so that we can easily follow along.
Code chunks should have appropriate chunk options set (e.g. code should render and execute, but warnings and messages should be suppressed, long data frames should not be printed out, etc.).
Send your instructor (Sam Shanny-Csik) and TA (Annie Adams) a rendered version of your HW2-exploration.qmd file by 11:59pm PT on Sat 02/04/2025 following these steps:
a. ensure that your YAML specifies these options, at a minimum:
---
title: "your HW #2 title"
author: "your Name"
date: xxxx-xx-xx
format:
  html:
    embed-resources: true # this ensures that your rendered .html file is self-contained, so we (your instructors) can open it and view all your work
---

b. render your HW2-exploration.qmd file, verify that you can open the resulting HW2-exploration.html file in your browser, and that all formatting looks good
c. save a copy of HW2-exploration.html to your Desktop, rename it it so that it has your first initial / last name at the start (e.g. SShannyCsik-HW2-exploration.html), then send it to both your instructor (Sam Shanny-Csik) and TA (Annie Adams) on Slack via direct message
